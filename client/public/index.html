<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="stylesheet" href="/3rdpartystatic/cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/theme/neo.css" />

    <title>Dgraph Ratel Dashboard</title>

    <script>
        function isTemplateAnnotation(str) {
            var l = str.length;
            return l > 4 && str[0] === "{" && str[1] === "{" && str[l-1] === "}" && str[l-2] === "}";
        }

        function getServerAddr(href) {
            return (!href || isTemplateAnnotation(href)) ? "" : href;
        };

        // Proper url with scheme/protocol passed by the server.
        window.SERVER_ADDR = getServerAddr("{{.}}");
    </script>
</head>

<body>
    <noscript>
        You need to enable JavaScript to run this app.
    </noscript>

    <div id="root">

      <div id="cachedjs-root" style="width: 320px; margin: 10vh auto; text-align: center;">
        <div id="cachedjs-loading-text" style="margin: 20px auto; font-size: 24px; display: none">
          <i class="fa fa-spinner fa-fw fa-spin" aria-hidden="true" style="font-size: 64px; display: block; margin: 0 auto" ></i>
          Loading...
        </div>
        <div id="cachedjs-offline-message" style="margin: 20px auto; font-size: 24px; text-align: justify; display: none">
          <i class="fa fa-warning fa-fw" aria-hidden="true" style="font-size: 64px; color: #82211b; display: block; margin: 0 auto" ></i>
          We seem to have difficulties loading latest client.<br/>
          Try using the <a id="cachedjs-link" href="#cachedjs">packaged version</a> instead.
          (Or continue waiting if you have a slow internet connection)
        </div>
      </div>


    </div>

    <script>

      function injectUrls(jsUrl, cssUrl) {
        if ("%CDN_MODE%" === "dev") {
          console.info('Dev mode detected. Not injecting URLs.');
          return;
        }

        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = jsUrl;
        document.body.appendChild(script);

        var link = document.createElement("link");
        link.type = "text/css";
        link.rel = "stylesheet";
        link.href = cssUrl;
        document.head.appendChild(link);
      }

      function loadCachedJS() {
        injectUrls('/static/js/main.js', '/static/css/main.css');
      }

      function loadProdJS() {
        injectUrls('%CDN_URL%static/js/main.js', '%CDN_URL%static/css/main.css');
      }

      function setVisibility(elId, visible) {
        try {
          document.getElementById(elId).style.display = !visible ? 'none' : null;
        } catch (e) {
          console.error('Unable to set visibility of ' + elId + '  to ' + visible);
        }
      }

      // Tell the user we've started loading
      setVisibility("cachedjs-loading-text", true);

      if (window.location.search === "?cachedjs") {
        loadCachedJS();
      } else {
        loadProdJS();

        setTimeout(function() {
          var el = document.getElementById('cachedjs-root');
          if (!el) {
            // React already took over.
            return;
          }

          setVisibility("cachedjs-loading-text", false);
          setVisibility("cachedjs-offline-message", true);

          var link = document.getElementById('cachedjs-link');
          link.href = window.location.origin + "?cachedjs";
        }, 20000);
      }

    </script>

    <!-- Typeform -->
    <script> (function() { var qs,js,q,s,d=document, gi=d.getElementById, ce=d.createElement, gt=d.getElementsByTagName, id="typef_orm_share", b="https://embed.typeform.com/"; if(!gi.call(d,id)){ js=ce.call(d,"script"); js.id=id; js.src=b+"embed.js"; q=gt.call(d,"script")[0]; q.parentNode.insertBefore(js,q) } })() </script>
</body>

</html>
