<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="stylesheet" href="/3rdpartystatic/cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/theme/neo.css" />

    <title>Dgraph Ratel Dashboard</title>

    <script>
        function isTemplateAnnotation(str) {
            return str.indexOf("{{") === 0 && str.lastIndexOf("}}") === str.length - 2;
        }
        function getServerAddr(href) {
            return isTemplateAnnotation(href) ? "" : href;
        };
        // Proper url with scheme/protocol passed by the server.
        window.SERVER_ADDR = getServerAddr("{{ .Addr }}");
    </script>

    <script>
      window.RATEL_CDN_MODE = "%CDN_MODE%";
      window.RATEL_LOADER_HTML = "{{ .LoaderHtml }}";
    </script>
</head>

<body>
    <noscript>
        You need to enable JavaScript to run this app.
    </noscript>

    <div id="root">

      <div id="cachedjs-root" style="width: 320px; margin: 10vh auto; text-align: center;">
        <div id="cachedjs-loading-text" style="margin: 20px auto; font-size: 24px; display: none">
          <i class="fa fa-spinner fa-fw fa-spin" aria-hidden="true" style="font-size: 64px; display: block; margin: 0 auto" ></i>
          Loading...
        </div>
        <div id="cachedjs-offline-message" style="margin: 20px auto; font-size: 24px; text-align: justify; display: none">
          <i class="fa fa-warning fa-fw" aria-hidden="true" style="font-size: 64px; color: #82211b; display: block; margin: 0 auto" ></i>
          We seem to have difficulties loading latest client.<br/>
          Try using the <a id="cachedjs-link" href="#cachedjs">packaged version</a> instead.
          (Or continue waiting if you have a slow internet connection)
        </div>
      </div>


    </div>

    <script>

      function injectUrls(jsUrl, cssUrl) {
        if (window.RATEL_CDN_MODE === "dev") {
          console.info('Dev mode detected. Not injecting URLs.');
          return;
        }

        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = jsUrl;
        document.body.appendChild(script);

        var link = document.createElement("link");
        link.type = "text/css";
        link.rel = "stylesheet";
        link.href = cssUrl;
        document.head.appendChild(link);
      }

      function loadPrefixedJS(prefix) {
        console.info('Loading Ratel code from ', prefix);
        injectUrls(prefix + 'static/js/main.js', prefix+ 'static/css/main.css');
      }

      var COOKIE_NAME = "ratelAutoloadUrl";

      function readCookie(name) {
          let nameEQ = name + "=";
          let ca = document.cookie.split(";");
          for (let i = 0; i < ca.length; i++) {
              let c = ca[i];
              while (c.charAt(0) === " ") c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) === 0)
                  return c.substring(nameEQ.length, c.length);
          }

          return null;
      }

      function setVisibility(elId, visible) {
        try {
          document.getElementById(elId).style.display = !visible ? 'none' : null;
        } catch (e) {
          console.error('Unable to set visibility of ' + elId + '  to ' + visible);
        }
      }

      // Tell the user we've started loading
      setVisibility("cachedjs-loading-text", true);

      var locSearch = window.location.search;

      function startLoadingTimer(prefix) {
        setTimeout(function() {
          var el = document.getElementById('cachedjs-root');
          if (!el) {
            // React already took over.
            return;
          }

          setVisibility("cachedjs-loading-text", false);
          setVisibility("cachedjs-offline-message", true);

          var link = document.getElementById('cachedjs-link');
          link.href = window.location.origin + "?cachedjs";
        }, 20000);
      }

      if (locSearch === "?cachedjs") {
        // Empty prefix means local server's /static folder.
        loadPrefixedJS('');
        startLoadingTimer();
      } else if (readCookie(COOKIE_NAME) && locSearch !== "?nocookie") {
        loadPrefixedJS(readCookie(COOKIE_NAME));
        startLoadingTimer();
      } else {
        var fieldPrefix = "?cdn="
        if (locSearch.indexOf(fieldPrefix) == 0) {
          loadPrefixedJS(locSearch.substring(fieldPrefix.length));
          startLoadingTimer();
        } else {
          document.open();
          document.write(RATEL_LOADER_HTML);
          document.close();
        }
      }

    </script>

    <!-- Typeform -->
    <script> (function() { var qs,js,q,s,d=document, gi=d.getElementById, ce=d.createElement, gt=d.getElementsByTagName, id="typef_orm_share", b="https://embed.typeform.com/"; if(!gi.call(d,id)){ js=ce.call(d,"script"); js.id=id; js.src=b+"embed.js"; q=gt.call(d,"script")[0]; q.parentNode.insertBefore(js,q) } })() </script>
</body>

</html>
